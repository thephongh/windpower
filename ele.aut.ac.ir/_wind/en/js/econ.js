// Copyright 1998 S¿ren Krohn & Danish Wind Turbine Manufacturers AssociationgPlot=null;save1=null;Crun();function CkW(){	if (document.forms[0].kW.selectedIndex==0) Set600();	if (document.forms[0].kW.selectedIndex==1) Set225();	if (document.forms[0].kW.selectedIndex==2) Set1500();	if (document.forms[0].kW.selectedIndex==3) Clr();	Crun();}function Ccurr(){	document.forms[0].kW.selectedIndex=document.forms[0].kW.options.length-1;}function Cinst(){	if (document.forms[0].inst.value!="included"){		var inst=parseFloat(document.forms[0].inst.value);		document.forms[0].inst.value=inst;		if (inst<0){			alert("Installation costs must be at least 0. ");			document.forms[0].inst.value=0;		}		Rpct();	}	Cadd();}function Set225(){	document.forms[0].yrs.value=20;	document.forms[0].curr.value="USD";	document.forms[0].turb.value=200000;	document.forms[0].pct.selectedIndex=2;	document.forms[0].inst.value=60000;	document.forms[0].tot.value=260000;	document.forms[0].kWh.value=600000;	document.forms[0].tarif.value=0.05;	document.forms[0].income.value=30000;	document.forms[0].use[0].checked=true;	document.forms[0].mpct.value=1.5;	document.forms[0].om.value=3000;	document.forms[0].net.value=27000;	document.forms[0].hrs.value="";	document.forms[0].i.value=5;	ResetCalc();}function Set600(){	document.forms[0].yrs.value=20;	document.forms[0].curr.value="USD";	document.forms[0].turb.value=450000;	document.forms[0].pct.selectedIndex=2;	document.forms[0].inst.value=135000;	document.forms[0].tot.value=585000;	document.forms[0].kWh.value=1500000;	document.forms[0].tarif.value=0.05;	document.forms[0].income.value=75000;	document.forms[0].use[0].checked=true;	document.forms[0].mpct.value=1.5;	document.forms[0].om.value=6750;	document.forms[0].net.value=68250;	document.forms[0].hrs.value="";	document.forms[0].i.value=5;	ResetCalc();}function Set1500(){	document.forms[0].yrs.value=20;	document.forms[0].curr.value="DKK";	document.forms[0].turb.value=17460000;	document.forms[0].inst.value=("included");	document.forms[0].pct.selectedIndex=document.forms[0].pct.options.length-1;	document.forms[0].tot.value=17460000;	document.forms[0].kWh.value=5046000;	document.forms[0].tarif.value=0;	document.forms[0].income.value=0;	document.forms[0].use[1].checked=true;	document.forms[0].mpct.value="";	document.forms[0].hrs.value=0.08;	document.forms[0].om.value="403680";	document.forms[0].net.value="-403680";	document.forms[0].i.value=5;	ResetCalc();}function Clr(){	document.forms[0].yrs.value="50";	document.forms[0].curr.value="";	document.forms[0].turb.value=0;	document.forms[0].inst.value=0;	document.forms[0].pct.selectedIndex=document.forms[0].pct.options.length-1;	document.forms[0].tot.value=0;	document.forms[0].kWh.value=0;	document.forms[0].tarif.value=0;	document.forms[0].income.value=0;	document.forms[0].use[2].checked=true;	document.forms[0].mpct.value="";	document.forms[0].hrs.value=0;	document.forms[0].om.value=0;	document.forms[0].net.value=0;	document.forms[0].i.value=5;	ResetCalc();	document.forms[0].yrs.value="20";	document.forms[0].npv.value="";	document.forms[0].rrr.value="";	document.forms[0].elec.value="";}function ResetCalc(){	document.forms[0].comment.value= document.forms[0].comment.defaultValue;	document.forms[0].a0.value=-parseFloat(document.forms[0].tot.value);	var j=GetOffset("a1");	var x=parseFloat(document.forms[0].net.value);	var yrs=parseInt(document.forms[0].yrs.value);	for (var i=j;i<j+yrs;i++){document.forms[0].elements[i].value=x;}	for (var i=j+yrs;i<document.forms[0].length;i++){	document.forms[0].elements[i].value=0;	}}function GetOffset(s){	var j=-1;	for (var i=0;i<document.forms[0].length;i++){		if (document.forms[0].elements[i].name==s){			j=i;			i=document.forms[0].length;		}	}	return(j);}function Cturb(){	var turb=parseFloat(document.forms[0].elements["turb"].value);	document.forms[0].elements["turb"].value=turb;	if (0>=turb){		alert ("Turbine must have a positive purchase price, please try again");		document.forms[0].elements["turb"].value= document.forms[0].elements["turb"].defaultValue;	}	document.forms[0].elements["kW"].selectedIndex= document.forms[0].elements["kW"].options.length-1;	Cpct();	Cadd();	if (document.forms[0].elements["use"][0].checked==true) Cmpct();}function Cpct(){	var val=20+5*document.forms[0].elements["pct"].selectedIndex;	if (val<45) document.forms[0].elements["inst"].value=val*0.01*document.forms[0].elements["turb"].value;	Cadd();}function Rpct(){	var ins=parseFloat (document.forms[0].elements["inst"].value);	var turb=parseFloat(document.forms[0].elements["turb"].value);	if (turb>0){		var p=Math.round(100*ins/turb);		if (p==20){document.forms[0].elements["pct"].selectedIndex=0;return;}		if (p==25){document.forms[0].elements["pct"].selectedIndex=1;return;}		if (p==30){document.forms[0].elements["pct"].selectedIndex=2;return;}		if (p==35){document.forms[0].elements["pct"].selectedIndex=3;return;}		if (p==40){document.forms[0].elements["pct"].selectedIndex=4;return;}	}	document.forms[0].elements["pct"].selectedIndex=5;}function Cadd(){	var inst=0;	if (document.forms[0].inst.value!="included") inst=parseFloat(document.forms[0].inst.value);	var turb=parseFloat(document.forms[0].turb.value);	document.forms[0].tot.value=inst+turb;	ResetCalc();	Crun();}function Ctot(){	alert("You cannot change the investment total directly, you must change the turbine price and/or the installation cost.");	Cadd();}function Cuse (){	if (document.forms[0].elements["use"][0].checked==true){		document.forms[0].elements["hrs"].value=""		var turb=parseFloat(document.forms[0].elements["turb"].value);		var om=parseFloat(document.forms[0].elements["om"].value);		document.forms[0].elements["mpct"].value=100*om/turb;	}	if (document.forms[0].elements["use"][1].checked==true){		document.forms[0].elements["mpct"].value="";		var om=parseFloat(document.forms[0].elements["om"].value);		var kWh=parseFloat(document.forms[0].elements["kWh"].value);		document.forms[0].elements["hrs"].value=om/kWh;	}	if (document.forms[0].elements["use"][2].checked==true){		document.forms[0].elements["mpct"].value="";		document.forms[0].elements["hrs"].value="";	}}function Cmpct(){	document.forms[0].elements["use"][0].checked=true;	var mpct=parseFloat(document.forms[0].elements["mpct"].value);	var turb=parseFloat(document.forms[0].elements["turb"].value);	document.forms[0].elements["om"].value=mpct*0.01*turb;	document.forms[0].elements["hrs"].value="";	Cnet();	Crun();}function Chrs(){	document.forms[0].elements["use"][1].checked=true;	document.forms[0].elements["mpct"].value="";	var hrs=parseFloat(document.forms[0].elements["hrs"].value);	var kWh=parseFloat(document.forms[0].elements["kWh"].value);	document.forms[0].elements["om"].value=kWh*hrs;	Cnet();	Crun();}function Com(){	var om=parseFloat(document.forms[0].elements["om"].value);		document.forms[0].elements["om"].value=om;	Cnet();	Cuse();	Crun();}function Cnet(){	var income=parseFloat(document.forms[0].elements["income"].value);	var om=parseFloat(document.forms[0].elements["om"].value);	document.forms[0].elements["net"].value=income-om;	ResetCalc();}function Cyrs(){	var yrs=parseInt(document.forms[0].elements["yrs"].value);	document.forms[0].elements["yrs"].value=yrs;	var max=document.forms[0].elements.length-GetOffset("a0")-1;	if ((0>=yrs)||(yrs>max)){		alert ("Investment must have a lifetime beween 1 and "+max+" years.");		document.forms[0].elements["yrs"].value=document.forms[0].elements["yrs"].defaultValue;	}	ResetCalc();	Crun();}function Ci(){	Crun();}function CkWh(){	if (document.forms[0].elements["use"][1].checked&&document.forms[0].elements["hrs"].value!=" ") Chrs();	if (document.forms[0].elements["tarif"].value==""){		var income=parseFloat(document.forms[0].elements["income"].value);		var kWh=parseFloat(document.forms[0].elements["kWh"].value);		document.forms[0].elements["tarif"].value =income/kWh;	}	Rincome();	Crun();}function Ctarif(){	if (document.forms[0].elements["kWh"].value==""){		var income=parseFloat(document.forms[0].elements["income"].value);		var tarif=parseFloat(document.forms[0].elements["tarif"].value);		document.forms[0].elements["kWh"].value=income/tarif;	}	Rincome();	Crun();}function Cincome(){	document.forms[0].elements["kWh"].value="";	document.forms[0].elements["tarif"].value="";	Cnet();	Crun();}function Rincome(){	var kWh=0;	if (document.forms[0].elements["kWh"].value!="") kWh= parseFloat(document.forms[0].elements["kWh"].value);	var tarif=0;	if (document.forms[0].elements["tarif"].value!="") tarif= parseFloat(document.forms[0].elements["tarif"].value);	document.forms[0].elements["income"].value=kWh*tarif;	Cnet();}function Cnpv(){	var r=0.01*parseFloat(document.forms[0]. i.value);	var x=GetPayments();	document.forms[0].npv.value=Disk(x, r);}function Celec(){	var kWh=parseFloat(document.forms[0].kWh.value);	var r=0.01*parseFloat(document.forms[0].i.value);	var income=parseFloat(document.forms[0].income.value);	var x=GetPayments();	for (var i=1;i<x.length;i++){		if (x[i]!=0)  x[i]-=income;	}	var elec=Disk(x, r);	var kWhSum=new Array(0);	for (var i=1;i<x.length;i++){		kWhSum[i]=kWh;	}	kWhSum[0]=0.0;	var dsum=Disk(kWhSum,r);	document.forms[0].elec.value=- elec/dsum;}function Disk(vector, interest){	var r=1/(1.0+interest);	var res=0.0;	var rton=1.0;	for (var i=0;i<vector.length;i++){		res+=vector[i]*rton;		rton*=r;	}	return(res);}function Crrr(){	document.forms[0].rrrcom.value=document.forms[0].rrrcom.defaultValue;	var x=GetPayments();	if (save1!=null) PlotIt("Real Rate of Return", x, Intr);	document.forms[0].elements["rrr"].value=0.001*Math.round(100000*(Intr(x)-1));}function Intr(m){	var r=1/1.1;	var rton=1;	var dk=new Array(m.length);	for (var i=0;i<m.length;i++){dk[i]=m[i]*i;}	var oldr=0;	var k=0;	var t=0;	var max=dk.length -1;	var sum=0;	while (Math.abs(r-oldr)>=0.00001&&t<10)	{		t+=1;		rton=1;		k=0;		sum=0;		for (var i=0;i<max;i++){			sum+=rton*dk[i+1];			k+=m[i]*rton;			rton*=r;		}		k+=m[i]*rton;		oldr=r;		r=r-k/sum;	}	if (t==10){		r=1;		document.forms[0].rrrcom.value="cannot be computed";	}	return(1/r);}function Crun(){	Cnpv();	Crrr();	Celec();}function Cr(){	document.forms[0].comment.value="Warning: Payments were changed manually!";	Crun();}function Creset(){	document.forms[0].reset();	Crun();}function Crrrcom(){	document.forms[0].rrrcom.value=document.forms[0].rrrcom.defaultValue;}function Ccomment(){	document.forms[0].comment.value=document.forms[0].comment.defaultValue;}function CplotElec(){	if (gPlot!=null) gPlot.close();	save1=GetPayments();}function PlotIt(name, save2, method){	gPlot=window.open("","","status=yes,width=320,height=240");	gPlot.document.write("<HEAD><TITLE>"+name+"</TITLE></HEAD><BODY BGCOLOR='#ffffff'><TABLE WIDTH='300' HEIGHT='200' BORDER='0' CELLSPACING='0' CELLPADDING='0'>");	var rrr=new Array(300);	var w=new Array(save1.length);	var min=Number.POSITIVE_INFINITY;	var max=Number.NEGATIVE_INFINITY;	if (save1.length==save2.length){		for (var i=0;i<300;i++){			for (var j=0;j<save1.length;j++){				w[j]=save1[j] +( i /299)*(save2[j]-save1[j]);			}			rrr[i]=method(w);			if (rrr[i]<min) min=rrr[i];			if (rrr[i]>max) max=rrr[i];		}	}	else{		alert("Sorry, lifetime change is not supported in plot function.");		gPlot.close();		return;	}	if (max==min) max=min+1;	var f=200/(max-min);	var y=0;	for (var i=0;i<300;i++){		y=Math.round(f*(rrr[i]-min));		gPlot.document.write("<TD>");		gPlot.document.write("<IMG SRC='../../r/t.gif' HEIGHT='"+(200-y)+"' WIDTH='1'><BR><IMG SRC='../../res/bluepix.gif' HEIGHT='1' WIDTH='1'></TD>");	}	gPlot.document.write("</TABLE></BODY>");}function GetPayments(){	var j=GetOffset("a0");	var x=new Array();	var i=0;	var y=0;	for (var j=j;j<document.forms[0].elements.length;j++){		y=parseFloat(document.forms[0].elements[j].value);		if (y!=0) x[i]=y;		i+=1;	}	return(x);}